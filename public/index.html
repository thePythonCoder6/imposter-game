<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Imposter Who? – Online</title>
  <style>
    body { font-family: Arial, sans-serif; background: #0f0f1a; color: #e0e0ff; margin: 0; padding: 20px; text-align: center; }
    h1 { color: #ff5555; }
    button { background: #2e7d32; color: white; border: none; padding: 14px 32px; margin: 12px; font-size: 1.15em; border-radius: 8px; cursor: pointer; min-width: 220px; }
    button:hover { background: #388e3c; }
    button.reveal { background: #d32f2f; font-size: 1.4em; padding: 18px 48px; }
    select, input { padding: 12px; font-size: 1.1em; margin: 10px; width: 90%; max-width: 360px; border-radius: 8px; background: #1a1a33; color: white; border: 1px solid #444; }
    #player-card { background: #1a1a33; border: 3px solid #3366ff; border-radius: 12px; padding: 28px 20px; margin: 30px auto; max-width: 480px; display: none; }
    #player-name { font-size: 2.3em; color: #88ccff; margin-bottom: 16px; }
    #secret-word-container { font-size: 3.2em; font-weight: bold; margin: 24px 0; min-height: 1.2em; background: #000; color: #000; padding: 16px; border-radius: 10px; transition: all 0.3s; }
    #secret-word-container.visible { background: transparent; color: inherit; }
    .imposter { color: #ff4444; }
    #status { font-size: 1.4em; background: #202040; padding: 18px; border-radius: 10px; margin: 20px 0; min-height: 90px; }
    #players-list { font-size: 1.15em; margin: 16px 0; line-height: 1.5; }
  </style>
</head>
<body>

<h1>Imposter Who? – Online</h1>

<div id="menu">
  <button onclick="showScreen('create')">Create Room</button><br><br>
  <button onclick="showScreen('join')">Join Room</button>
</div>

<div id="create" style="display:none;">
  <select id="category"></select><br>
  <input id="createName" placeholder="Your name" value="Host"><br>
  <button onclick="createRoom()">Create</button><br><br>
  <button onclick="showScreen('menu')">Back</button>
</div>

<div id="join" style="display:none;">
  <input id="joinCode" placeholder="Room code" maxlength="6"><br>
  <input id="joinName" placeholder="Your name"><br>
  <button onclick="joinRoom()">Join</button><br><br>
  <button onclick="showScreen('menu')">Back</button>
</div>

<div id="lobby" style="display:none;">
  <h2>Room: <span id="roomCodeDisplay"></span></h2>
  <div id="players-list">Waiting...</div>
  <div id="reveal-section" style="display:none;">
    <button class="reveal" onclick="revealGame()">Reveal Imposter & Word (Host)</button>
  </div>
</div>

<div id="game" style="display:none;">
  <div id="status">Look privately! Click "Seen" when ready.</div>
  <div id="player-card">
    <div id="player-name"></div>
    <div id="role-text"></div>
    <div id="secret-word-container"><span id="secretWord"></span></div>
    <button id="seenBtn">I've Seen It</button>
  </div>
</div>

<div id="result" style="display:none;">
  <h2>Game Over</h2>
  <p id="impReveal"></p>
  <p id="wordReveal"></p>
  <button onclick="location.reload()">Play Again</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

function showScreen(id) {
  document.querySelectorAll('#menu, #create, #join, #lobby, #game, #result').forEach(el => el.style.display = 'none');
  document.getElementById(id).style.display = 'block';
}

// Populate categories (full list)
const catSelect = document.getElementById('category');
Object.keys(categories).sort().forEach(key => {  // assumes categories defined in server, but client has stub
  const opt = document.createElement('option');
  opt.value = key;
  opt.text = key.replace(/_/g, ' ').toUpperCase();
  catSelect.appendChild(opt);
});

let currentRoom = '';
let isHost = false;

socket.on('roomCreated', ({ code }) => {
  currentRoom = code;
  document.getElementById('roomCodeDisplay').textContent = code;
  showScreen('lobby');
  isHost = true;
});

socket.on('joined', ({ code }) => {
  currentRoom = code;
  document.getElementById('roomCodeDisplay').textContent = code;
  showScreen('lobby');
});

socket.on('playersUpdate', (players) => {
  let html = '<h3>Players:</h3>';
  players.forEach(p => html += `<div>${p.name}${p.seen ? ' ✓' : ''}</div>`);
  document.getElementById('players-list').innerHTML = html;

  if (isHost && players.every(p => p.seen) && players.length >= 3) {
    document.getElementById('reveal-section').style.display = 'block';
  }
});

socket.on('gameStarted', ({ imposterIndex, secret }) => {
  showScreen('game');
  document.getElementById('player-name').textContent = 'You';
  const myIdx = players.findIndex(p => p.id === socket.id);  // assume players from last update
  if (myIdx === imposterIndex) {
    document.getElementById('role-text').textContent = 'You are the...';
    document.getElementById('secretWord').textContent = 'IMPOSTER!';
    document.getElementById('secretWord').className = 'imposter';
  } else {
    document.getElementById('role-text').textContent = 'The secret word is:';
    document.getElementById('secretWord').textContent = secret;
  }
  document.getElementById('player-card').style.display = 'block';
  document.getElementById('seenBtn').onclick = () => socket.emit('markSeen', currentRoom);
});

socket.on('gameRevealed', ({ imposterName, secret }) => {
  showScreen('result');
  document.getElementById('impReveal').innerHTML = `Imposter: <strong>${imposterName}</strong>`;
  document.getElementById('wordReveal').innerHTML = `Word: <strong>${secret}</strong>`;
});

socket.on('error', alert);

function createRoom() {
  const name = document.getElementById('createName').value.trim() || 'Host';
  const cat = document.getElementById('category').value;
  socket.emit('createRoom', { name, category: cat });
}

function joinRoom() {
  const code = document.getElementById('joinCode').value.trim().toUpperCase();
  const name = document.getElementById('joinName').value.trim();
  if (!code || !name) return alert('Fill both');
  socket.emit('joinRoom', { code, name });
}

function revealGame() {
  socket.emit('reveal', currentRoom);
}

showScreen('menu');
</script>
</body>
</html>
